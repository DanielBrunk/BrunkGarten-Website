---
interface Props {
  videoId: string;
  title: string;
}

const { videoId, title } = Astro.props;
const thumbnailUrl = `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;
---

<div class="video-facade" data-video-id={videoId}>
  <img src={thumbnailUrl} alt={title} loading="lazy" width="480" height="360" />
  <button class="video-facade__play" aria-label={`Video abspielen: ${title}`}>
    <svg viewBox="0 0 68 48" width="68" height="48" aria-hidden="true">
      <path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55C3.97 2.33 2.27 4.81 1.48 7.74.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/>
      <path d="M45 24 27 14v20" fill="white"/>
    </svg>
  </button>
</div>

<style>
  .video-facade {
    position: relative;
    aspect-ratio: 16/9;
    background-color: #000;
    border-radius: var(--radius-md);
    overflow: hidden;
    cursor: pointer;
  }

  .video-facade img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-facade__play {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
    border: none;
    padding: 0;
    cursor: pointer;
    transition: background var(--transition-fast);
  }

  .video-facade__play:hover {
    background: rgba(0, 0, 0, 0.15);
  }

  .video-facade iframe {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>

<script>
  document.querySelectorAll('.video-facade').forEach((el) => {
    el.addEventListener('click', function () {
      const videoId = (this as HTMLElement).dataset.videoId;
      const iframe = document.createElement('iframe');
      iframe.src = `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1`;
      iframe.allow = 'autoplay; encrypted-media';
      iframe.setAttribute('allowfullscreen', '');
      iframe.setAttribute('loading', 'lazy');
      (this as HTMLElement).innerHTML = '';
      (this as HTMLElement).appendChild(iframe);
    }, { once: true });
  });
</script>
